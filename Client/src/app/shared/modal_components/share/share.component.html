<div
  appTheme
  class="outer"
  [ngClass]="[
    pService.isCollapseShared && (notes.length > 1 || folders.length > 1) ? 'half-helper' : '',
    notes.length > 1 || folders.length > 1 ? 'many-notes' : 'one-note'
  ]"
>
  <div class="few-notes" *ngIf="notes.length > 1 || folders.length > 1">
    <app-dialog-generic-header
      [message]="'modal.shareModal.selectedNotes' | translate"
      [isMessage]="pService.isCollapseShared"
      (clickEvent)="collapseToggle()"
    >
    </app-dialog-generic-header>

    <ng-scrollbar
      *ngIf="data.currentWindowType === windowType.Note"
      class="notes-sharing"
      [visibility]="'hover'"
      [track]="'all'"
      [appearance]="'compact'"
    >
      <div
        class="note"
        *ngFor="let item of notes"
        CustomTooltip="{{ item.title }}"
        position="Top"
        [ngStyle]="{ backgroundColor: item.color }"
        labelColor="{{ item.color }}"
        [ngClass]="{ 'active-note': currentNote?.id === item.id }"
        (click)="selectNote(item)"
        flagDisable="{{ disableTooltipUser() }}"
      >
        <p *ngIf="item.title && item.title.length > 0">{{ item.title }}</p>
        <p *ngIf="!item.title" class="empty-placeholder">
          {{ 'placeholder.unnamedNote' | translate }}
        </p>
      </div>
    </ng-scrollbar>

    <ng-scrollbar
      *ngIf="data.currentWindowType === windowType.Folder"
      class="notes-sharing"
      [visibility]="'hover'"
      [track]="'all'"
      [appearance]="'compact'"
    >
      <div
        class="note"
        *ngFor="let item of folders"
        CustomTooltip="{{ item.title }}"
        position="Top"
        [ngStyle]="{ backgroundColor: item.color }"
        labelColor="{{ item.color }}"
        [ngClass]="{ 'active-note': currentFolder?.id === item.id }"
        (click)="selectFolder(item)"
        flagDisable="{{ disableTooltipUser() }}"
      >
        <p *ngIf="item.title && item.title.length > 0">{{ item.title }}</p>
        <p *ngIf="!item.title" class="empty-placeholder">
          {{ 'placeholder.unnamedFolder' | translate }}
        </p>
      </div>
    </ng-scrollbar>
  </div>
  <div class="sharing">
    <app-dialog-generic-header
      [message]="'modal.shareModal.Share' | translate"
      (clickEvent)="dialogRef.close()"
    >
    </app-dialog-generic-header>

    <mat-tab-group class="tabs" mat-stretch-tabs #tabs>
      <mat-tab isActive="true" [label]="'modal.shareModal.access' | translate">
        <div class="tab-content">
          <div class="content-access content-padding">
            <div class="link-access-field">
              <input
                *ngIf="data.currentWindowType === windowType.Note"
                readonly
                type="text"
                [value]="currentNote?.id | sharingLink: data.currentWindowType"
                id="linkInputNote"
              />
              <input
                *ngIf="data.currentWindowType === windowType.Folder"
                readonly
                type="text"
                [value]="currentFolder?.id | sharingLink: data.currentWindowType"
                id="linkInputFolder"
              />
              <div class="dropdown-wrapper" *ngIf="folderDropdownActive">
                <app-select
                  class="dropdown-button"
                  [translate]="'modal.shareModal'"
                  [selectValue]="folderSelectedValue"
                  (selectValueChange)="changeRefTypeFolder($event)"
                >
                  <app-select-option *ngFor="let item of refTypes" [value]="item">
                    {{ 'modal.shareModal.' + item | translate }}
                  </app-select-option>
                </app-select>
              </div>
              <div class="dropdown-wrapper" *ngIf="noteDropdownActive">
                <app-select
                  class="dropdown-button"
                  [translate]="'modal.shareModal'"
                  [selectValue]="noteSelectedValue"
                  (selectValueChange)="changeRefTypeNote($event)"
                >
                  <app-select-option *ngFor="let item of refTypes" [value]="item">
                    {{ 'modal.shareModal.' + item | translate }}
                  </app-select-option>
                </app-select>
              </div>
              <div class="copy" #copy (click)="copyInputLink()">
                <div class="ripple-container" matRipple [matRippleTrigger]="copy"></div>
                <div class="icon">
                  <mat-icon svgIcon="copy"></mat-icon>
                </div>
              </div>
            </div>
            <div *ngIf="data.currentWindowType === windowType.Note" class="toggle-field">
              <app-button-toggle
                class="toggle"
                [value]="isPrivateButtonActive ? false : true"
                [style]="'classic'"
                (valueChange)="changeNoteType()"
              >
                <app-toggle-text
                  on
                  [color]="
                    (theme$ | async) === themes.Dark && isPrivateButtonActive ? '#202020' : ''
                  "
                >
                  {{ 'modal.shareModal.personal' | translate }}</app-toggle-text
                >
                <app-toggle-text
                  off
                  [color]="
                    (theme$ | async) === themes.Dark && isSharedButtonActive ? '#202020' : ''
                  "
                >
                  {{ 'modal.shareModal.shared' | translate }}</app-toggle-text
                >
              </app-button-toggle>
              <div class="toggle-description">
                <p *ngIf="currentNote?.noteTypeId === noteType.Shared">
                  {{ 'modal.shareModal.sharedMessage' | translate }}
                </p>
                <p *ngIf="currentNote?.noteTypeId !== noteType.Shared">
                  {{ 'modal.shareModal.noSharedMessage' | translate }}
                </p>
              </div>
            </div>
            <div *ngIf="data.currentWindowType === windowType.Folder" class="toggle-field">
              <app-button-toggle
                class="toggle"
                [value]="isPrivateButtonActive ? false : true"
                [style]="'classic'"
                (valueChange)="changeFolderType()"
              >
                <app-toggle-text
                  on
                  [color]="
                    (theme$ | async) === themes.Dark && isPrivateButtonActive ? '#202020' : ''
                  "
                >
                  {{ 'modal.shareModal.personal' | translate }}</app-toggle-text
                >
                <app-toggle-text
                  off
                  [color]="
                    (theme$ | async) === themes.Dark && isSharedButtonActive ? '#202020' : ''
                  "
                >
                  {{ 'modal.shareModal.shared' | translate }}</app-toggle-text
                >
              </app-button-toggle>
              <div class="toggle-description">
                <p *ngIf="currentFolder?.folderTypeId === folderType.Shared">
                  {{ 'modal.shareModal.sharedMessage' | translate }}
                </p>
                <p *ngIf="currentFolder?.folderTypeId !== folderType.Shared">
                  {{ 'modal.shareModal.noSharedMessage' | translate }}
                </p>
              </div>
            </div>
          </div>
          <ng-container *ngIf="!isLoading">
            <div
              *ngIf="(invitedUsers$ | async).length !== 0"
              class="clear-container content-padding"
            >
              <p (click)="clearAll()">{{ 'modal.shareModal.clearAll' | translate }}</p>
            </div>
            <ng-scrollbar class="user-access" [visibility]="'hover'" [appearance]="'compact'">
              <div class="content-inner content-padding">
                <ng-container *ngIf="data.currentWindowType === windowType.Note">
                  <app-user-on-entity-card
                    *ngFor="let user of invitedUsers$ | async"
                    [user]="user"
                    (changeUserPermission)="changeUserPermission($event, user.id)"
                    (removeUserWithPermissions)="removeUserWithPermissions(user.id)"
                  ></app-user-on-entity-card>
                  <div
                    *ngIf="(invitedUsers$ | async).length === 0"
                    class="empty-placeholder-container"
                  >
                    <p>{{ 'modal.shareModal.noPeopleNote' | translate }}</p>
                  </div>
                </ng-container>
                <ng-container *ngIf="data.currentWindowType === windowType.Folder">
                  <app-user-on-entity-card
                    *ngFor="let user of invitedUsers$ | async"
                    [user]="user"
                    (changeUserPermission)="changeUserPermission($event, user.id)"
                    (removeUserWithPermissions)="removeUserWithPermissions(user.id)"
                  ></app-user-on-entity-card>
                  <div
                    *ngIf="(invitedUsers$ | async).length === 0"
                    class="empty-placeholder-container"
                  >
                    <p>{{ 'modal.shareModal.noPeopleFolder' | translate }}</p>
                  </div>
                </ng-container>
              </div>
            </ng-scrollbar>
          </ng-container>
          <div *ngIf="isLoading" class="spinner-container">
            <app-spinner [size]="20"></app-spinner>
          </div>
        </div>
      </mat-tab>
      <mat-tab label="{{ 'modal.shareModal.Share' | translate }}">
        <div class="tab-content">
          <div class="search-container content-padding">
            <app-search class="search" (changeOutput)="changed($event)"></app-search>
          </div>
          <div
            *ngIf="searchUsers.length === 0 && selectedUsers.length === 0 && !isSearching"
            class="empty-placeholder-container"
          >
            <p>{{ 'modal.shareModal.noPeopleNote' | translate }}</p>
          </div>

          <app-mail-invitations
            *ngIf="selectedUsers.length > 0"
            [selectedUsers]="selectedUsers"
            (applyForm)="sendInvites($event)"
            (removeUserFromInvites)="removeUserFromInvites($event)"
          ></app-mail-invitations>

          <ng-container *ngIf="!isSearching && searchUsers.length > 0">
            <ng-scrollbar
              class="interaction-container"
              [@smoothOpacity]
              [visibility]="'hover'"
              [appearance]="'compact'"
            >
              <div class="interaction-inner-container">
                <div *ngIf="searchUsers.length > 0" class="user-suggestions content-padding">
                  <div *ngFor="let user of searchUsers" class="user">
                    <div class="photo">
                      <img
                        alt="user image"
                        *ngIf="!user.noPhoto"
                        (error)="user.noPhoto = true"
                        [src]="user.photoPath"
                      />
                      <div *ngIf="user.noPhoto" class="no-photo">
                        <mat-icon svgIcon="people" [inline]="true"></mat-icon>
                      </div>
                    </div>
                    <div class="email">
                      <p>{{ user.email }}</p>
                    </div>
                    <div class="user-access-func">
                      <button type="button" name="Share user note" (click)="addUserToInvite(user)">
                        <div class="icon">
                          <mat-icon svgIcon="plus" [inline]="true"></mat-icon>
                        </div>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </ng-scrollbar>
          </ng-container>
          <div *ngIf="isSearching" class="spinner-container">
            <app-spinner [size]="20"></app-spinner>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>
